# NGINX image that renders config at container start via custom entrypoint
FROM nginx:1.27-alpine

# Copy template and entrypoint
COPY nginx.tmpl.conf /etc/nginx/templates/nginx.tmpl.conf
COPY entrypoint-nginx.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

# Copy SSL certs into the image (generated by x-docker-build.sh into ./certs)
COPY certs /etc/nginx/certs

# Expose 443 (already exposed in runtime by compose port mapping)
EXPOSE 443

# Use custom entrypoint to render config and start nginx
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
